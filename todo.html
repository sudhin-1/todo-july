<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>todo</title>
    <!-- bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <!-- fontawesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Ancizar+Serif:ital,wght@0,300..900;1,300..900&family=Dancing+Script:wght@400..700&family=Exile&family=GFS+Didot&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Kapakana:wght@300..400&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
</head>
<style>
    .logout:hover {
        text-decoration: underline;
    }
</style>

<body>
    <div style="background: linear-gradient(to right, #11998e, #0f6e87); min-height: 100vh;">
        <nav class="navbar " style="background: transparent; background-color: #0f6e87;">
            <div class="container">
                <a class="navbar-brand text-white fw-bold" href="#">
                    RANDOM
                </a>
                <a href="#" class="text-white" onclick="logOut()">logout</a>
            </div>
        </nav>
        <h1 class="ms-5 my-5" style="color: bisque;">Welcome <span id="displayUser" style="color: rgb(217, 220, 26);  font-family: 'Dancing Script', cursive;">User</span></h1>
        <div class="d-flex justify-content-center ">
            <button class=""
                style="background-color: rgb(209, 209, 190); border-radius: 5px; padding:0 20px; margin-top: 30px; border: none;"
                onclick="getRandomtodo()">Add</button>
        </div>

        <div class="d-flex justify-content-center ">
            <table class="table my-5 table-dark table-striped-column overflow-hidden rounded-2"
                style="width: 75%; border-radius: 5px; " id="resultTable">
                <thead style="background-color: transparent;">
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Task</th>
                        <th scope="col">Status</th>
                        <th scope="col">Action</th>
                    </tr>
                </thead>
                <tbody style="background-color: transparent;" id="result">

                </tbody>
            </table>

        </div>
    </div>
</body>
<script>

     document.addEventListener("DOMContentLoaded", () => {
        if (localStorage.getItem("user")) {
            document.getElementById("displayUser").innerHTML = localStorage.getItem("user");
        } else {
            alert("Please login")
            window.location = "index.html"
        }
    });
    
    //logout function
    function logOut()
    {
        localStorage.clear()
        window.location = "index.html"

        
    }

    let currentIndex = 1;
    const getRandomtodo = () => {
        //creating obj
        const api = new XMLHttpRequest()
        //open
        api.open("GET", "https://dummyjson.com/todos")
        //send
        api.send()

        //event bind
        api.onreadystatechange = () => {
            console.log(api.readyState);
            if (api.readyState == 4) {
                if (api.status >= 200 && api.status < 300) {
                    const res = JSON.parse(api.responseText)
                    const to_dos = res.todos;

                    const randomIndex = Math.floor(Math.random() * to_dos.length)
                    console.log(randomIndex);
                    const displayQuote = to_dos[randomIndex].todo

                    console.log(to_dos);
                    console.log(res);
                    let tableRow = ""
                    if (to_dos[randomIndex].completed == true) {
                        tableRow = `
                    <tr>
                        <th scope="row">${currentIndex}</th>
                        <td>${displayQuote}</td>
                        <td>Complete</td>
                        <td><i class="fa-solid fa-xmark ms-2" style="color: #ff1a1a; cursor:pointer" onclick=handleCross(this)></i></td>
                    </tr>                   
                    `;
                    } else {
                        tableRow = `
                    <tr>
                        <th scope="row">${currentIndex}</th>
                        <td>${displayQuote}</td>
                        <td id="notComplete">Incomplete</td>
                        <td>
                        <i class="fa-solid fa-check ms-2 mx-5" style="color: #74d534;  cursor:pointer" onclick=handleCheck(this) ></i>
                        <i class="fa-solid fa-xmark ms-2" style="color: #ff1a1a; cursor:pointer" onclick=handleCross(this)></i></td>
                    </tr>                   
                    `;
                    }

                    result.innerHTML += tableRow;
                    currentIndex++;
                } else {
                    console.log("request failed");

                }

            } else {
                console.log("waiting for response");

            }
        }

    }

    const handleCross = (elem) => {
        elem.parentNode.parentNode.remove();

        const tableRows = document.querySelectorAll("#resultTable tbody tr");
        tableRows.forEach((tr, index) => {
            tr.querySelector("th").innerText = index + 1;
        });


        currentIndex = tableRows.length + 1;
    }

    const handleCheck = (elem) => {
        const row = elem.closest("tr")
        console.log(row);
        row.children[2].innerText = "Complete";
        elem.remove()
    }


</script>

</html>